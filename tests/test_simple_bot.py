"""
–¢–µ—Å—Ç —É–ø—Ä–æ—â—ë–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞
"""
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ src –≤ –ø—É—Ç—å
root_dir = Path(__file__).parent.parent
sys.path.insert(0, str(root_dir))
sys.path.insert(0, str(root_dir / "src"))


def test_simple_bot():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ø—Ä–æ—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –±–æ—Ç–∞"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ –±–æ—Ç–∞...")

    try:
        from src.core.simple_chat_manager import SimpleChatManager

        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä
        print("1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SimpleChatManager...")
        chat_manager = SimpleChatManager()
        print("‚úÖ SimpleChatManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")

        # –¢–µ—Å—Ç 1: –û–±—ã—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å
        print("\n2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...")
        response = chat_manager.handle_message("test_user", "–†–∞—Å—Å–∫–∞–∂–∏ –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç")
        print(f"–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: {len(response)} —Å–∏–º–≤–æ–ª–æ–≤")
        if len(response) > 100:
            print("‚úÖ –†–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω")
        else:
            print("‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç")

        # –¢–µ—Å—Ç 2: –ó–∞–ø—Ä–æ—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        print("\n3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π...")
        rec_response = chat_manager.handle_message(
            "test_user2",
            "–ü–æ—Å–æ–≤–µ—Ç—É–π –º–Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º—É - —è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å –æ–ø—ã—Ç–æ–º –≤ Python –∏ –º–∞—à–∏–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏"
        )
        print(f"–û—Ç–≤–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏: {len(rec_response)} —Å–∏–º–≤–æ–ª–æ–≤")
        if "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏" in rec_response.lower() or "–ø—Ä–æ–≥—Ä–∞–º–º–∞" in rec_response.lower():
            print("‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω—ã")
        else:
            print("‚ö†Ô∏è –ù–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏")

        # –¢–µ—Å—Ç 3: –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å
        print("\n4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞...")
        irrelevant_response = chat_manager.handle_message("test_user3", "–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è?")
        print(f"–û—Ç–≤–µ—Ç –Ω–∞ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å: {irrelevant_response}")
        if "–æ—Ç–≤–µ—á–∞—é —Ç–æ–ª—å–∫–æ" in irrelevant_response.lower():
            print("‚úÖ –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω")
        else:
            print("‚ö†Ô∏è –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞")

        print("\nüéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    test_simple_bot()
